<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>%VERSION%</title>
  <link href="https://www.layuicdn.com/layui-v2.9.7/css/layui.css" rel="stylesheet">
  <link href="index.css" rel="stylesheet">
</head>
<body>
  <h3>Model:%BOARD% IP:%IP% Based on websocket</h3>
  <form class="layui-form" action=""> 
  
<div class="layui-tab layui-tab-brief" lay-filter="test-handle">
  <ul class="layui-tab-title">
    <li class="layui-this1" lay-id="11">ws2812 LEDs</li>
    <li lay-id="22">sr04 Distance Sensor</li>
    <li lay-id="33">Switch/Light/Relay</li>
    <li lay-id="44">DHT11 Temperature/Humidity</li>
    <li lay-id="55">OLED</li>
    <li lay-id="66">Infrared Remote</li>
    <li class="layui-this1" lay-id="77">Servo - Not completed</li>
    <li class="layui-this1" lay-id="88">ADC Analog Port - Not completed</li>
    <li class="layui-this" lay-id="99">Online Update - Not debugged</li>
  </ul>
  <div class="layui-tab-content">
    <div class="layui-tab-item layui-show1">
      Instructions: GND to <font color="red">GND</font>, VCC to <font color="red">3v3</font>, VIN to <font color="red">Pin</font>
      <div class="layui-tab-item layui-show">
        <div class="layui-inline">
          <label class="layui-form-label">Pin</label>
          <div class="layui-input-inline">
            <select id="aPin" lay-search>
              <option value="4" >D2 GPIO04</option>
              <option value="14">D5 GPIO14</option>
              <option value="12">D6 GPIO12</option>
            </select>
          </div>
        </div>
        <div class="layui-inline">
          <label class="layui-form-label">Number of LEDs</label>
          <div class="layui-input-inline">
            <select id="aNum" lay-search>
              <option value="1"  >1</option>
              <option value="3"  >3</option>
              <option value="8"  >8</option>
              <option value="64" >64</option>
              <option value="256">256</option>
            </select>
          </div>
        </div>
  
        <div class="layui-inline">
          <label class="layui-form-label">Color</label>
          <div class="layui-input-inline">
            <select id="aColor">
              <option value="1">Red</option>
              <option value="2">Green</option>
              <option value="3">Blue</option>
              <option value="4">Black</option>
              <option value="5">Purple</option>
              <option value="6">Yellow</option>
              <option value="7">Cyan</option>
              <option value="8">Orange</option>
            </select>
          </div>
        </div>
  
        <div class="layui-inline">
          <label class="layui-form-label">Brightness</label>
          <div class="layui-input-inline">
            <select id="aBright" lay-search>
              <option value="1"  >1</option>
              <option value="10" >10</option>
              <option value="20" >20</option>
              <option value="100">100</option>
              <option value="255">255</option>
            </select>
          </div>
        </div>  
      </div>
  
      <div class="layui-form-item">
        <div class="layui-input-block">
          <button type="button" class="layui-btn" id="btnA">Start</button>
          <button type="reset" class="layui-btn layui-btn-primary">Reset</button>
        </div>
      </div>

    </div>
    
    <!--------->
    <div class="layui-tab-item">
      Instructions: GND to <font color="red">GND</font>, VCC to <font color="red">3v3</font>, SCL to <font color="red">Pin SCL</font>, SDA to <font color="red">Pin SDA</font>. If reversed, it will be 0.00
      <div class="layui-tab-item layui-show">
        <div class="layui-inline">
          <label class="layui-form-label">Pin SCL</label>
          <div class="layui-input-inline">
            <select id="bPinSCL" lay-search>
              <option value="14">D5 GPIO14</option>
              <option value="12">D6 GPIO12</option>
            </select>
          </div>
        </div>
        <div class="layui-inline">
          <label class="layui-form-label">Pin SDA</label>
          <div class="layui-input-inline">
            <select id="bPinSDA" lay-search>
              <option value="12">D6 GPIO12</option>
              <option value="14">D5 GPIO14</option>
            </select>
          </div>
        </div>
      
      </div>
  
      <div class="layui-form-item">
        <div class="layui-input-block">
          <button type="button" class="layui-btn" id="btnB">Start</button>
          <button type="reset" class="layui-btn layui-btn-primary">Reset</button>
        </div>
      </div>    
    
    </div>
    
    <!--------->
    <div class="layui-tab-item">
      Instructions: GND to <font color="red">GND</font>, VCC to <font color="red">3v3</font>, VIN to <font color="red">Pin</font>. Can be used for output devices like lasers. Note: High/low levels may sometimes be reversed.
      <div class="layui-tab-item layui-show">
        <div class="layui-inline">
          <label class="layui-form-label">Pin</label>
          <div class="layui-input-inline">
            <select id="cPin" lay-search>
              <option value="4" >D2 GPIO04</option>
              <option value="14">D5 GPIO14</option>
              <option value="12">D6 GPIO12</option>
            </select>
          </div>
        </div>
      </div>
      
      <div class="layui-form-item">
        <div class="layui-input-block">
          <button type="button" class="layui-btn" id="btnC">Start</button>
          <button type="reset" class="layui-btn layui-btn-primary">Reset</button>
        </div>
      </div>
    
    </div>
    
    <!--DHT11-->
    <div class="layui-tab-item">
      Instructions: GND to <font color="red">GND</font>, VCC to <font color="red">3v3</font>, DATA to <font color="red">D2 GPIO4</font>
      <div class="layui-form-item">
        <div class="layui-input-block">
          <button type="button" class="layui-btn" id="btnD">Start (click multiple times)</button>
        </div>
      </div>
    </div>
    
    <!--OLED-->
    <div class="layui-tab-item">
      Instructions: GND to <font color="red">GND</font>, VCC to <font color="red">3v3</font>, SCL to <font color="red">D5 GPIO14</font>, SDA to <font color="red">D6 GPIO12</font>
      <div class="layui-form-item">
        <div class="layui-input-block">
          <button type="button" class="layui-btn" id="btnE">Start</button>
          <button type="reset" class="layui-btn layui-btn-primary">Reset</button>
        </div>
      </div>    
    </div>
    
    <!--Infrared Remote-->
    <div class="layui-tab-item layui-show1">
      Instructions: GND to <font color="red">GND</font>, VCC to <font color="red">3v3</font>, DATA to <font color="red">D2 GPIO4</font>
      <div class="layui-form-item">
        <div class="layui-input-block">
          Connect to ws to see button presses. Response time: 1 second.
        </div>
      </div>
    </div>
    
    <!--Servo-->
    <div class="layui-tab-item layui-show1">
      Instructions: GND to <font color="red">GND</font>, VCC to <font color="red">3v3</font>, DATA to <font color="red">D2 GPIO4</font>
      <div class="layui-form-item">
        <div class="layui-input-block">
          <button type="button" class="layui-btn" id="btnD">Start (click multiple times)</button>
        </div>
      </div>
    </div>
    
    <!--ADC-->
    <div class="layui-tab-item layui-show1">
      Instructions: GND to <font color="red">GND</font>, VCC to <font color="red">3v3</font>, DATA to <font color="red">D2 GPIO4</font>
      <div class="layui-form-item">
        <div class="layui-input-block">
          <button type="button" class="layui-btn" id="btnD">Start (click multiple times)</button>
        </div>
      </div>
    </div>
    
    <!--Online Update-->
    <div class="layui-tab-item layui-show">
      Instructions: Click to start update. No confirmation prompts.
      <div class="layui-tab-item layui-show">
        <div class="layui-inline">
          <label class="layui-form-label">Host Address</label>
          <div class="layui-input-inline">
            <input type="text" id="iHost" size="80" class="layui-input" value="%OTAHOST%">
          </div>
        </div>
      </div>
      
      <div class="layui-form-item">
        <div class="layui-input-block">
          <button type="button" class="layui-btn" id="btnOTA"  >Update Kernel</button>
          <button type="button" class="layui-btn" id="btnOTAFS">Update Interface</button>
          <button type="button" class="layui-btn layui-btn-danger" id="btnREBOOT">Restart</button>
        </div>
      </div>
    </div>
  </div>
</div>
<hr>

<div class="layui-input-group">
  <div class="layui-input-prefix"><h3>Debug Area</h3></div>
  <!--
  <input type="text" class="layui-input" size="30" id="urlWs" value="ws://%IP%/ws">
  -->
  <input type="text" class="layui-input" size="30" id="urlWs" value="ws://192.168.123.124/ws">

  <div class="layui-input-suffix">
    <button type="button" class="layui-btn" id="btnWs"   >Toggle ws</button>
    <button type="button" class="layui-btn" id="btnClear">Clear Debug Area</button>
  </div>
</div>

<div style="overflow-y: auto;flex: 1;height:200px" id="mmo">
</div>
</form>


<div id="bottom-div" onclick="showAlert()">
  ZhongJiYun Wave 10
</div>
  
<script src="https://www.layuicdn.com/layui-v2.9.7/layui.js"></script>
<script>
function showAlert() {
  if (confirm("Do you want to reset and reconfigure the network?")) {
    // User clicked "OK"
    window.location.href = "reset";
    } else {
      // User clicked "Cancel"
  }
}

var mainurl = 'http://%IP%/';
var pattern = /192\.168/;
if (pattern.test(window.location.href)) {
} else {
  mainurl = 'http://192.168.123.124/';
}

layui.use(function(){
  var $ = layui.$;
  var form = layui.form;
  var layer = layui.layer;  
  var socket = '';
  var isConn = 0;

  /////////////////
  //Debug Area-------
  $('#btnClear').on('click', function(){
    //layer.msg('Clicking a button without specific attributes will not trigger the component's submit event');
    //document.getElementById("mmo").innerHTML = "";
    $('#mmo').empty();
  });

  function info(str){
    //document.getElementById('mmo')

    $("#mmo").append(str+'<br>');
    var objDiv = document.getElementById("mmo");
    objDiv.scrollTop = objDiv.scrollHeight;
  }

  //Send message to websocket
  function send(str){
    socket.send(str);
    info('<font color="green">Sent message: ' + str + '</font>');
  }

  //Restart websocket after port change
  function restartWs(){
    if(isConn==1) socket.close();

    wsUrl = $('#urlWs').val();
    socket = new WebSocket(wsUrl);
  //websocket
  //var socket = new WebSocket($('#urlWs').val());
  //var socket = new WebSocket('ws://124.222.224.186:8800');
  //var socket = new WebSocket('ws://192.168.123.123/ws');


    // Listen for connection open event
    socket.onopen = function(event) {
      info('WebSocket connection established');
      isConn = 1;
    };

    // Listen for message received event
    socket.onmessage = function(event) {
      info('<font color="blue">Received message: ' + event.data + '</font>');
    };

    // Listen for connection close event
    socket.onclose = function(event) {
      info('WebSocket connection closed');
      isConn = 0;
    };
  }

  //////////////////////////////////////
  //ws2812
  $('#btnA').on('click', function(){
    if(isConn == 0){
      layer.msg('WebSocket not connected');
    }else{
      var aPin   =$('#aPin').val();
      var aNum   =$('#aNum').val();
      var aColor =$('#aColor').val();
      var aBright=$('#aBright').val();
      send('ws2812|'+aPin+'|'+aNum+'|'+aColor+'|'+aBright);
    }
  });
  
  //sr04
  $('#btnB').on('click', function(){
    if(isConn == 0){
      layer.msg('WebSocket not connected');
    }else{
      var bPinSCL   =$('#bPinSCL').val();
      var bPinSDA   =$('#bPinSDA').val();
      send('sr04|'+bPinSCL+'|'+bPinSDA);
    }
  });
  
  //switch
  var cOn = 0;
  $('#btnC').on('click', function(){
    if(isConn == 0){
      layer.msg('WebSocket not connected');
    }else{
      if(cOn == 0) {
        cOn = 1;
      }else{
        cOn = 0;
      }
      var cPin   =$('#cPin').val();
      send('switch|'+cPin+'|'+cOn);
    }
  });
  
  
  //dht11
  $('#btnD').on('click', function(){
    $.ajax({
      url: mainurl + 'dht',
      type: 'GET',
      success: function(response){
        info('<font color="blue">Received message: ' + response + '</font>');
      },
      error: function(xhr, status, error){
        // Handle request failure
        layui.use('layer', function(){
          var layer = layui.layer;
          layer.msg('GET request failed: ' + error);
        });
      }
    });
  });
  
  
  //OLED
  $('#btnE').on('click', function(){
    $.ajax({
      url: mainurl + 'oled' ,  // Replace with your backend interface address
      type: 'GET',
      success: function(response){
        info('<font color="blue">Received message: ' + response + '</font>');
      },
      error: function(xhr, status, error){
        // Handle request failure
        layui.use('layer', function(){
          var layer = layui.layer;
          layer.msg('GET request failed: ' + error);
        });
      }
    });
  });
  
  //OTAHOST
  $('#btnOTA').on('click', function(){
    window.open('/auto');
  });
  
  $('#btnOTAFS').on('click', function(){
    window.open('/autofs');
  });  

  
  $('#btnREBOOT').on('click', function(){
    window.open('/reboot');
  });  

  $('#btnWs').on('click', function(){
      restartWs();
  });

  //info('asdf');

});
</script>

</body>
</html>
